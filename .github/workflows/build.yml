name: Build Fusion (Independent)
on: [push]

jobs:
  # WINDOWS BUILD (Sollte jetzt durchlaufen)
  build-windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: recursive
      - uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - name: Install Tools
        run: |
          pip install pyinstaller pymobiledevice3
          if (Test-Path Nugget/requirements.txt) { pip install -r Nugget/requirements.txt }
      - name: Build EXE
        run: |
          # Wir erstellen den Ordner zur Sicherheit, falls das Submodule leer ist
          if (!(Test-Path Nugget)) { New-Item -ItemType Directory -Path Nugget }
          pyinstaller --onefile --windowed --add-data "Nugget;Nugget" FusionMain.py
      - uses: actions/upload-artifact@v4
        with:
          name: Fusion-Windows
          path: dist/*.exe

  # MAC BUILD (Mit Fehler-Toleranz)
  build-macos:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: recursive
      - uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - name: Install Tools
        run: |
          pip install pyinstaller pymobiledevice3
          # Requirements ignorieren, falls Datei fehlt
          [ -f Nugget/requirements.txt ] && pip install -r Nugget/requirements.txt || echo "No reqs"
      - name: Build App
        run: |
          mkdir -p Nugget # Sicherheitshalber
          # Auf Mac nutzt PyInstaller einen Doppelpunkt : zum Trennen
          pyinstaller --onefile --windowed --add-data "Nugget:Nugget" FusionMain.py
      - name: Zip Mac App
        run: cd dist && zip -r FusionMain_Mac.zip FusionMain.app
      - uses: actions/upload-artifact@v4
        with:
          name: Fusion-Mac
          path: dist/FusionMain_Mac.zip
